<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../css/weui.min.css">
    <link rel="stylesheet" href="../lib/bootstrap-3.3.7-dist/css/bootstrap.css">
    <link rel="stylesheet" href="../css/regist.css">
    <link rel="stylesheet" href="../css/common.css">
    <link rel="stylesheet" href="../css/appointment.css">
    <title>我的申请</title>
</head>
<body>
    <div class="containerOut applicationContainer">
        <div class="headerBar">
            <p class="title">我的申请</p>
        </div>
        <div class="containerInner">
            <div class="orderList clearfix" id="orderListBox">
                <!--  申请列表 -->
            </div>
        </div>
    </div>
</body>
</html>
<script src="../js/jQuery/jquery-3.4.0.js"></script>
<script src="../lib/layer/layer.js"></script>
<script src="../js/common.js"></script>
<script>
    $(function(){
        var openId= getUrlParam('openid') // 获取用户openid
        /* -------------- 我的预约记录 ----------------- */
        function getApplicationList(id) {
            $.ajax({
                url: baseUrl+'/api/appointment/list?wxId='+id,
                type: 'post',
                success: function(res){
                    for (let i = 0; i < res.length; i++) {
                        // 1.0 审核状态
                        var checkStatus;
                        var payStatus;
                        var appointmentType; 
                        var createDate= new Date(res[i].createTime)
                        createDate= createDate.getFullYear()+'-'+(createDate.getMonth()>10?createDate.getMonth():"0"+createDate.getMonth())+'-'+(createDate.getDate()>10?createDate.getDate():"0"+createDate.getDate());
                        if(res[i].status == "01") {
                            checkStatus= "待审核";
                        }else if(res[i].status == "02") {
                            checkStatus= "审核通过";
                        }else if(res[i].status == "03") {
                            checkStatus= "审核不通过";
                        }
                        // 2.0 支付状态
                        if(res[i].payStatus == "01") {
                            payStatus= "待支付";
                        }else if(res[i].payStatus == "02") {
                            payStatus= "已支付";
                        }else if(res[i].payStatus == "03") {
                            payStatus= "已支付预约款";
                        }
                        // 3.0 获取方式
                        if(res[i].appointmentType == "01") {
                            appointmentType= "自提";
                        }else if(res[i].appointmentType == "02") {
                            appointmentType= "邮寄";
                        }else if(res[i].appointmentType == "03") {
                            appointmentType= "物流查询";
                        }
                        var orderItem= '<a class="baseInfo orderInfo" href="./appointment.html?pageIndex=4&expressType='+res[i].appointmentType+'&ids='+res[i].id+'">'+
                                            '<span class="stateBox">'+
                                                '<img src="../img/userIcon03.jpg" alt="" class="stateFlag"><br>'+
                                                '<span class="stateText succState">'+checkStatus+'</span>'+
                                            '</span>'+
                                            '<span class="patientsName">'+res[i].patientName+'</span>'+
                                            '<span class="hospitalName">'+res[i].hospitalName+'</span>'+
                                            '<span class="typeBox">'+
                                                '<span class="sendType type">'+payStatus+'</span>'+
                                                '<span class="recordType type">'+appointmentType+'</span>'+
                                                '<span class="recordType type">'+createDate+'</span>'+
                                            '</span>'+
                                        '</a>'
                        $('#orderListBox').append(orderItem);             
                    }
                } 
            })
        }

        
        getApplicationList(openId);// 查询我的预约记录

    })
</script>